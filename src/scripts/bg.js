!function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;e.GM=function(t,e,n,i){e.VERSION="1.2.3",t.json=function(t){return t.json()},t.fetchError=function(t){e.trigger("connection_error")};var r=function(t,e,i){switch(t){case 1:return function(){return n[e](this[i])};case 2:return function(t){return n[e](this[i],t)};case 3:return function(t,r){return n[e](this[i],cb(t,this),r)};case 4:return function(t,r,s){return n[e](this[i],cb(t,this),r,s)};default:return function(){var t=slice.call(arguments);return t.unshift(this[i]),n[e].apply(n,t)}}},s=e.Events={},o=/\s+/,c=function(t,e,i,r,s){var a,u=0;if(i&&"object"==typeof i){void 0!==r&&"context"in s&&void 0===s.context&&(s.context=r);for(a=n.keys(i);u<a.length;u++)e=c(t,e,a[u],i[a[u]],s)}else if(i&&o.test(i))for(a=i.split(o);u<a.length;u++)e=t(e,a[u],r,s);else e=t(e,i,r,s);return e};s.on=function(t,e,n){return a(this,t,e,n)};var a=function(t,e,n,i,r){if(t._events=c(u,t._events||{},e,n,{context:i,ctx:t,listening:r}),r){(t._listeners||(t._listeners={}))[r.id]=r}return t};s.listenTo=function(t,e,i){if(!t)return this;var r=t._listenId||(t._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[r];if(!o){var c=this._listenId||(this._listenId=n.uniqueId("l"));o=s[r]={obj:t,objId:r,id:c,listeningTo:s,count:0}}return a(t,e,i,this,o),this};var u=function(t,e,n,i){if(n){var r=t[e]||(t[e]=[]),s=i.context,o=i.ctx,c=i.listening;c&&c.count++,r.push({callback:n,context:s,ctx:s||o,listening:c})}return t};s.off=function(t,e,n){return this._events?(this._events=c(h,this._events,t,e,{context:n,listeners:this._listeners}),this):this},s.stopListening=function(t,e,i){var r=this._listeningTo;if(!r)return this;for(var s=t?[t._listenId]:n.keys(r),o=0;o<s.length;o++){var c=r[s[o]];if(!c)break;c.obj.off(e,i,this)}return this};var h=function(t,e,i,r){if(t){var s,o=0,c=r.context,a=r.listeners;if(e||i||c){for(var u=e?[e]:n.keys(t);o<u.length;o++){e=u[o];var h=t[e];if(!h)break;for(var l=[],f=0;f<h.length;f++){var d=h[f];i&&i!==d.callback&&i!==d.callback._callback||c&&c!==d.context?l.push(d):(s=d.listening)&&0==--s.count&&(delete a[s.id],delete s.listeningTo[s.objId])}l.length?t[e]=l:delete t[e]}return t}for(var g=n.keys(a);o<g.length;o++)s=a[g[o]],delete a[s.id],delete s.listeningTo[s.objId]}};s.once=function(t,e,i){var r=c(l,{},t,e,n.bind(this.off,this));return"string"==typeof t&&null===i&&(e=void 0),this.on(r,e,i)},s.listenToOnce=function(t,e,i){var r=c(l,{},e,i,n.bind(this.stopListening,this,t));return this.listenTo(t,r)};var l=function(t,e,i,r){if(i){var s=t[e]=n.once(function(){r(e,s),i.apply(this,arguments)});s._callback=i}return t};s.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=new Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return c(f,this._events,t,void 0,n),this};var f=function(t,e,n,i){if(t){var r=t[e],s=t.all;r&&s&&(s=s.slice()),r&&d(r,i),s&&d(s,[e].concat(i))}return t},d=function(t,e){var n,i=-1,r=t.length,s=e[0],o=e[1],c=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o,c);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}};s.bind=s.on,s.unbind=s.off,n.extend(e,s);var g=1e3;e.t={s:g,m:6e4,h:36e5};var v=e.Model=function(t,e){var i=t||{};e||(e={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var r=n.result(this,"defaults");i=n.defaults(n.extend({},r,i),r),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(v.prototype,s,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var r;"object"==typeof t?(r=t,i=e):(r={})[t]=e,i||(i={});var s=i.unset,o=i.silent,c=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=n.clone(this.attributes),this.changed={});var u=this.attributes,h=this.changed,l=this._previousAttributes;for(var f in r)e=r[f],n.isEqual(u[f],e)||c.push(f),n.isEqual(l[f],e)?delete h[f]:h[f]=e,s?delete u[f]:u[f]=e;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!o){c.length&&(this._pending=i);for(var d=0;d<c.length;d++)this.trigger("change:"+c[d],this,u[c[d]],i)}if(a)return this;if(!o)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,i={};for(var r in t){var s=t[r];n.isEqual(e[r],s)||(i[r]=s)}return!!n.size(i)&&i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)}});var p={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};!function(t,e,i){n.each(e,function(e,s){n[s]&&(t.prototype[s]=r(e,s,i))})}(v,p,"attributes");var b=function(t,e){var i,r=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,e),i.prototype=n.create(r.prototype,t),i.prototype.constructor=i,i.__super__=r.prototype,i};v.extend=b;var m=function(t,e,r,s){r=r||i.extension.getURL("images/icon-128.png"),e=e||i.i18n.getMessage("appName");var o=n.isObject(arguments[0])?e:{title:e,message:t};n.defaults(o,{type:"basic",iconUrl:r,title:e,message:""}),s=s||_.next(),i.notifications.create(s,o),_.l=s},_=e.Alert={l:0,oc:{},id:0,init:function(){var t=this;i.notifications.onClicked.addListener(function(e){t.oc[e]&&t.oc[e](e)})},onClick:function(t,e){return e&&(t=n.bind(t,e)),this.oc[this.last()]=t,this},show:function(t,e,n){return m(t,e,"",n),this},error:function(t,e,n){var r=i.extension.getURL("images/error-128.png");return m(t,e,r,n),this},block:function(t,e,n){var r=i.extension.getURL("images/block.png");return m(t,e,r,n),this},unblock:function(t,e,n){var r=i.extension.getURL("images/unblock.png");return m(t,e,r,n),this},next:function(){return"gm-notification-"+ ++this.id},last:function(){return this.l}};return _.init(),(e.config={remote:"http://e.4it.top/config.json",fetching:!1,loaded:!1,data:{},haveError:!1,showError:n.throttle(function(){this.haveError&&e.trigger("connection_error","config")},6e4),init:function(){e.on("config",function(){this.haveError&&(this.haveError=!1,_.show("Kết nối thành công!"))},this)},load:function(){this.loaded||(this.loaded=!0,this.ensure(),setInterval(n.bind(this.fetch,this),36e5))},ensure:function(){var t=this,n=function(){!t.valid()&&i.storage.local.get({config:{}},function(n){t.data=n.config,t.valid()?e.trigger("config"):t.fetch()}),setTimeout(n,5e3)};n()},fetch:function(){var t=this;this.fetching||(fetch(this.remote+"?_t="+(new Date).getTime()).then(json).then(function(n){if(t.fetching=!1,!n)return void(t.valid()||(t.haveError=!0,t.showError()));var r=t.get("version"),s=n?n.version:null;s&&(r&&r.toString()===s.toString()||(i.storage.local.set({config:n}),t.data=n,e.trigger("config")))}).catch(function(){t.fetching=!1,t.haveError=!0,t.showError()}),this.fetching=!0)},get:function(t){return this.data[t]},set:function(t,e){return null==t?this:("object"==typeof t?this.data=t:this.data[t]=e,this)},clear:function(){var t=this;i.storage.local.remove("config",function(){t.data={}})},valid:function(){return this.get("version")}}).init(),e}(e,{},e._,e.chrome)}(),function(t,e){var n=e.Model.extend({initialize:function(){this.reloading=!1,this.loading=!1,this.autoUpdate(),this.on("change",this.updated,this),this.on("reloaded",function(){e.Alert.show("Cập nhật thông tin thành công!"),this.updated()}),t.contextMenus.create({title:t.i18n.getMessage("refresh"),id:"menu_update",contexts:["browser_action"],onclick:_.bind(this.reload,this)})},autoUpdate:function(){setInterval(_.bind(this.getUserData,this),e.t.h)},updated:function(){this.get("admin")?e.admin.enable():e.admin.disable();var n=this.get("rank"),i=n>0?"#4286f4":"#db1a1a";t.storage.local.set(this.attributes),t.browserAction.setBadgeBackgroundColor({color:i}),t.browserAction.setBadgeText({text:n.toString()}),this.id?(t.browserAction.enable(),n<1&&e.Alert.show("Bạn hiện chưa có điểm xếp hạng, hãy kiếm điểm để ở lại cùng anh em nhé!")):this.notLogin()},notLogin:function(){t.browserAction.disable(),e.Alert.show("Hãy đăng nhập để nhận thông tin!").onClick(function(e){t.notifications.clear(e,function(){t.tabs.create({url:t.runtime.getManifest().homepage_url})})}),console.log(e.Alert.n)},load:function(t){this.id=t,this.getUserData()},reload:function(){if(!this.id)return void this.notLogin();this.reloading=!0,this.getUserData()},getUserData:function(){var t=this;this.loading||(fetch(e.config.get("api")+"/user/"+this.id).then(json).then(function(n){if(t.loading=!1,!n)return void e.trigger("connection_error");_.defaults(n,{id:t.id,name:"",rank:0,post:0,like:0,comment:0,liked:0,commented:0,spam:0}),t.trigger("fetched",n),t.set(n),t.trigger("loaded"),t.reloading&&(t.reloading=!1,t.trigger("reloaded"))}).catch(function(e){t.loading=!1,fetchError(e)}),this.loading=!0)}});e.user=window.user=new n}(chrome,GM),function(t,e){e.admin={init:function(){var e=this;this.enabled=!1,this.menus=[],t.runtime.onMessage.addListener(function(t){e.onMessage(t)})},onMessage:function(t){"GM.admin"===t.cmd&&this.notify(t)},enable:function(){this.enabled||(this.enabled=!0,this.addAdminMenu())},disable:function(){this.enabled&&(this.enabled=!1,this.menus.forEach(function(e){t.contextMenus.remove(e)}))},handle:function(n,i){var r=n.menuItemId.substr(5),s=n.linkUrl;this.getUserId(s).then(function(n){if(!n.id||!user.id||!user.get("admin"))return void e.Alert.error("Bạn không được phép sử dụng chức năng này!");if(n.id.toString()!==user.id.toString())if(n.protected)e.Alert.error("Bạn không thể chặn các admin khác!");else{var s={cmd:r,u:n.id,cu:user.id,g:e.config.get("group"),l:e.config.get("log_post")};t.tabs.sendMessage(i.id,s)}else e.Alert.error("Bạn không thể chặn chính mình!")})},getUserId:function(t){return new Promise(function(n,i){if(t){var r=new URL(t);if(r.pathname&&r.pathname.length>0){var s=r.pathname.toLowerCase(),o="/profile.php"===s?r.searchParams.get("id"):r.pathname.substr(1);o.includes("/")?n({id:0}):fetch(e.config.get("api")+"/fb?u="+o).then(json).then(function(t){n(t)}).catch(fetchError)}}})},addAdminMenu:function(){var e=this;this.menus.push(t.contextMenus.create({title:t.i18n.getMessage("removeUser"),id:"menu_remove",contexts:["link"],onclick:function(t,n){e.handle(t,n)},targetUrlPatterns:["https://*.facebook.com/*"]})),this.menus.push(t.contextMenus.create({title:t.i18n.getMessage("blockUser"),id:"menu_block",contexts:["link"],onclick:function(t,n){e.handle(t,n)},targetUrlPatterns:["https://*.facebook.com/*"]}))},notify:function(n){var i=t.i18n.getMessage(n.type+"Notify");if(("unblock"===n.type?e.Alert.unblock:e.Alert.block)(i+": "+n.user_id),e.config.get("log")){var r=new FormData;r.append("u",n.user_id),r.append("c_user",user.id),r.append("action",n.type),fetch(e.config.get("log"),{method:"POST",body:r}).catch(fetchError)}}},e.admin.init()}(chrome,GM),function(t,e){e.core={init:function(){this.c_user=0,this.last_user=null;var n=this;e.on("connection_error",function(t){e.Alert.error("Lỗi kết nối! Vui Lòng kiểm tra kết nối và thử lại!")}),t.browserAction.disable(),e.config.load(),e.on("config",function(){t.browserAction.enable(),n.checkUser()}),t.runtime.onUpdateAvailable.addListener(function(e){t.storage.local.set({new_version:e.version}),t.runtime.reload()}),t.runtime.onInstalled.addListener(function(e){if("install"===e.reason){var n=t.runtime.getManifest().homepage_url;t.tabs.create({url:n})}}),this._check=_.throttle(this.checkUser,200),this._update=_.throttle(this.update,2e4),t.tabs.onUpdated.addListener(function(t,i){e.config.valid()&&n._check(t,i)})},checkUser:function(){var e=this;t.cookies.get({url:"https://*.facebook.com",name:"c_user"},function(t){e.c_user=t?t.value:0,e.c_user||(this.last_user=null),e.run()})},run:function(){this.c_user!==this.last_user&&(this.last_user=this.c_user,this.userChanged()),this._update()},update:function(){},userChanged:function(){user.load(this.c_user)}},e.core.init()}(chrome,GM);