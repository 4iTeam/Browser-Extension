!function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;e.GM=function(t,e,n,i){t.GM;e.VERSION="1.3.3";var s=function(t,e,i){switch(t){case 1:return function(){return n[e](this[i])};case 2:return function(t){return n[e](this[i],t)};case 3:return function(t,s){return n[e](this[i],cb(t,this),s)};case 4:return function(t,s,r){return n[e](this[i],cb(t,this),s,r)};default:return function(){var t=slice.call(arguments);return t.unshift(this[i]),n[e].apply(n,t)}}},r=e.Events={},a=/\s+/,o=function(t,e,i,s,r){var c,u=0;if(i&&"object"==typeof i){void 0!==s&&"context"in r&&void 0===r.context&&(r.context=s);for(c=n.keys(i);u<c.length;u++)e=o(t,e,c[u],i[c[u]],r)}else if(i&&a.test(i))for(c=i.split(a);u<c.length;u++)e=t(e,c[u],s,r);else e=t(e,i,s,r);return e};r.on=function(t,e,n){return c(this,t,e,n)};var c=function(t,e,n,i,s){if(t._events=o(u,t._events||{},e,n,{context:i,ctx:t,listening:s}),s){(t._listeners||(t._listeners={}))[s.id]=s}return t};r.listenTo=function(t,e,i){if(!t)return this;var s=t._listenId||(t._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),a=r[s];if(!a){var o=this._listenId||(this._listenId=n.uniqueId("l"));a=r[s]={obj:t,objId:s,id:o,listeningTo:r,count:0}}return c(t,e,i,this,a),this};var u=function(t,e,n,i){if(n){var s=t[e]||(t[e]=[]),r=i.context,a=i.ctx,o=i.listening;o&&o.count++,s.push({callback:n,context:r,ctx:r||a,listening:o})}return t};r.off=function(t,e,n){return this._events?(this._events=o(h,this._events,t,e,{context:n,listeners:this._listeners}),this):this},r.stopListening=function(t,e,i){var s=this._listeningTo;if(!s)return this;for(var r=t?[t._listenId]:n.keys(s),a=0;a<r.length;a++){var o=s[r[a]];if(!o)break;o.obj.off(e,i,this)}return this};var h=function(t,e,i,s){if(t){var r,a=0,o=s.context,c=s.listeners;if(e||i||o){for(var u=e?[e]:n.keys(t);a<u.length;a++){e=u[a];var h=t[e];if(!h)break;for(var l=[],d=0;d<h.length;d++){var f=h[d];i&&i!==f.callback&&i!==f.callback._callback||o&&o!==f.context?l.push(f):(r=f.listening)&&0==--r.count&&(delete c[r.id],delete r.listeningTo[r.objId])}l.length?t[e]=l:delete t[e]}return t}for(var g=n.keys(c);a<g.length;a++)r=c[g[a]],delete c[r.id],delete r.listeningTo[r.objId]}};r.once=function(t,e,i){var s=o(l,{},t,e,n.bind(this.off,this));return"string"==typeof t&&null===i&&(e=void 0),this.on(s,e,i)},r.listenToOnce=function(t,e,i){var s=o(l,{},e,i,n.bind(this.stopListening,this,t));return this.listenTo(t,s)};var l=function(t,e,i,s){if(i){var r=t[e]=n.once(function(){s(e,r),i.apply(this,arguments)});r._callback=i}return t};r.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=new Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return o(d,this._events,t,void 0,n),this};var d=function(t,e,n,i){if(t){var s=t[e],r=t.all;s&&r&&(r=r.slice()),s&&f(s,i),r&&f(r,[e].concat(i))}return t},f=function(t,e){var n,i=-1,s=t.length,r=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++i<s;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,a);return;case 3:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,a,o);return;default:for(;++i<s;)(n=t[i]).callback.apply(n.ctx,e);return}};r.bind=r.on,r.unbind=r.off,n.extend(e,r);var g=e.Model=function(t,e){var i=t||{};e||(e={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var s=n.result(this,"defaults");i=n.defaults(n.extend({},s,i),s),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(g.prototype,r,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var s;"object"==typeof t?(s=t,i=e):(s={})[t]=e,i||(i={});var r=i.unset,a=i.silent,o=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={});var u=this.attributes,h=this.changed,l=this._previousAttributes;for(var d in s)e=s[d],n.isEqual(u[d],e)||o.push(d),n.isEqual(l[d],e)?delete h[d]:h[d]=e,r?delete u[d]:u[d]=e;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!a){o.length&&(this._pending=i);for(var f=0;f<o.length;f++)this.trigger("change:"+o[f],this,u[o[f]],i)}if(c)return this;if(!a)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,i={};for(var s in t){var r=t[s];n.isEqual(e[s],r)||(i[s]=r)}return!!n.size(i)&&i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)}});var p={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};!function(t,e,i){n.each(e,function(e,r){n[r]&&(t.prototype[r]=s(e,r,i))})}(g,p,"attributes");var v=function(t,e){var i,s=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return s.apply(this,arguments)},n.extend(i,s,e),i.prototype=n.create(s.prototype,t),i.prototype.constructor=i,i.__super__=s.prototype,i};g.extend=v;e.Alert={show:function(t,e,s){var r=i.extension.getURL("images/icon-128.png");e=e||i.i18n.getMessage("appName");var a=n.isObject(arguments[0])?e:{title:e,message:t};n.defaults(a,{type:"basic",iconUrl:r,title:e,message:""}),i.notifications.create(s,a)}},e.Config={data:{},load:function(){fetch()},get:function(t){return this.data[t]},set:function(t,e){return null==t?this:("object"==typeof t?this.data=t:this.data[t]=e,this)},clear:function(){this.data={}}};return e}(e,{},e._,e.chrome)}();var GM=GM||{};!function(t){var e=GM.Model.extend({initialize:function(){this.reloading=!1,this.loading=!1,this.hasAutoUpdate=!1,this.on("change",this.updated,this),this.on("reloaded",function(){GM.Alert.show("Cập nhật thông tin thành công!")}),t.contextMenus.create({title:t.i18n.getMessage("update"),id:"menu_update",contexts:["browser_action"],onclick:_.bind(this.reload,this)})},autoUpdate:function(){if(!this.hasAutoUpdate){this.hasAutoUpdate=!0;setInterval(_.bind(this.getUserData,this),36e5)}},updated:function(){this.autoUpdate(),this.get("admin")?GM.admin.enable():GM.admin.disable();var e=this.get("rank"),n=e>0?"#4286f4":"#db1a1a";t.storage.local.set(this.attributes),t.browserAction.setBadgeBackgroundColor({color:n}),t.browserAction.setBadgeText({text:e.toString()}),this.id?(t.browserAction.enable(),e<1&&GM.Alert.show("Bạn hiện chưa có điểm xếp hạng, hãy kiếm điểm để ở lại cùng anh em nhé!")):(t.browserAction.disable(),GM.Alert.show("Hãy đăng nhập để nhận thông tin!"))},load:function(t){this.id=t,this.getUserData()},reload:function(){this.reloading=!0,this.getUserData()},getUserData:function(){var t=this;this.loading||(fetch(GM.api+"/user/"+this.id).then(function(e){return t.loading=!1,e.json()}).then(function(e){_.defaults(e,{id:t.id,name:"",rank:0,post:0,like:0,comment:0,liked:0,commented:0,spam:0}),t.set(e),t.trigger("loaded"),t.reloading&&(t.reloading=!1,t.trigger("reloaded"))}),this.loading=!0)}});GM.user=window.user=new e}(chrome);var GM=GM||{};!function(t){GM.admin={init:function(){var e=this;this.enabled=!1,this.menus=[],t.runtime.onMessage.addListener(function(t){e.result(t)})},enable:function(){this.enabled||(this.enabled=!0,this.addAdminMenu())},disable:function(){this.enabled&&(this.enabled=!1,this.menus.forEach(function(e){t.contextMenus.remove(e)}))},handle:function(e,n){var i=e.menuItemId.substr(5),s=e.linkUrl;this.getUserId(s).then(function(e){if(!e.id||!user.id||!user.get("admin"))return void GM.Alert.show("Bạn không được phép sử dụng chức năng này!");e.id.toString()!==user.id.toString()?e.protected?GM.Alert.show("Bạn không thể chặn các admin khác!"):t.tabs.sendMessage(n.id,{cmd:i,u:user_id,cu:user.id}):GM.Alert.show("Bạn không thể chặn chính mình!")})},getUserId:function(t){return new Promise(function(e,n){if(t)try{var i=new URL(t);if(i.pathname&&i.pathname.length>0){var s=i.pathname.toLowerCase(),r="/profile.php"===s?i.searchParams.get("id"):i.pathname.substr(1);r.includes("/")?e({id:0}):fetch(GM.api+"/fb?u="+r).then(function(t){return t.json()}).then(function(t){e(t)})}}catch(t){e({id:0}),console.error(t.message)}})},addAdminMenu:function(){var e=this;this.menus.push(t.contextMenus.create({title:t.i18n.getMessage("removeUser"),id:"menu_remove",contexts:["link"],onclick:function(t,n){e.handle(t,n)},targetUrlPatterns:["https://*.facebook.com/*"]})),this.menus.push(t.contextMenus.create({title:t.i18n.getMessage("blockUser"),id:"menu_block",contexts:["link"],onclick:function(t,n){e.handle(t,n)},targetUrlPatterns:["https://*.facebook.com/*"]}))},result:function(e){if("GM.admin"===e.cmd){var n=(t.extension.getURL("images/icon-128.png"),t.i18n.getMessage(e.type+"Notify"));GM.Alert.show(n+": "+e.user_id)}}},GM.admin.init()}(chrome);var GM=GM||{};!function(t){GM.api="http://4it.top/api/v1",GM.core={init:function(){this.c_user=0,this.last_user=null;var e=this;t.runtime.onInstalled.addListener(function(e){if("install"===e.reason){var n=t.runtime.getManifest().homepage_url;t.tabs.create({url:n})}}),t.tabs.onUpdated.addListener(function(t,n){e._check(t,n)}),this._check=_.throttle(this.checkUser,200),this._update=_.throttle(this.update,2e4)},checkUser:function(){var e=this;t.cookies.get({url:"https://*.facebook.com",name:"c_user"},function(t){e.c_user=t?t.value:0,e.c_user||(this.last_user=null),e.run()})},run:function(){this.c_user!==this.last_user&&(this.last_user=this.c_user,this.userChanged()),this._update()},update:function(){},userChanged:function(){user.load(this.c_user)}},GM.core.init()}(chrome);